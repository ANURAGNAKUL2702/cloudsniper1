name: CI

on:
  push:
  pull_request:

jobs:  
  test:    
    runs-on: ubuntu-latest   
    steps: 
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run tests (force failure)
        run: |
          echo "Simulating CI failure"
          exit 1

      - name: Notify AutoFix (only if CI fails)
        if: failure()
        run: |
          curl -X POST https://anuragnakul.app.n8n.cloud/webhook/basic-test \
            -H "Content-Type: application/json" \
            -d '{
              "repo": "'"${GITHUB_REPOSITORY}"'",
              "run_id": "'"${GITHUB_RUN_ID}"'",
              "sha": "'"${GITHUB_SHA}"'",
              "ref": "'"${GITHUB_REF}"'",
              "status": "failed"
            }'
