name: ğŸš€ Real-World CI Setup

on:
  push:
    branches: [main, dev]
  pull_request:
    branches: [main]

jobs:
  setup-and-check:
    name: ğŸ§ª Setup & Check Folder Structure
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      # ------------------------- Setup Languages ------------------------
      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # -------------------------- Caching -------------------------------
      - name: ğŸ§  Restore cache
        uses: actions/cache@v4
        with:
          path: |
            node_modules
            venv
            key: ${{ runner.os }}-cache-${{ hashFiles('package-lock.json', 'requirements.txt') }}
            restore-keys: |
            ${{ runner.os }}-cache-




      # -------------------- Install Dependencies ------------------------
      - name: â˜• Install Java Dependencies (Maven)
        run: |
          for dir in */; do
          if [ -f "$dir/pom.xml" ]; then
          echo "â˜• Found pom.xml in $dir"
          cd "$dir"
          mvn install -DskipTests || echo "âš ï¸ mvn install failed in $dir"
          cd ..
          fi
          done


      - name: ğŸ Install Python Dependencies
        run: |
          for dir in */; do
          if [ -f "$dir/requirements.txt" ]; then
          echo "ğŸ“ Found requirements.txt in $dir"
          python -m pip install --upgrade pip
          pip install -r "$dir/requirements.txt" || echo "âš ï¸ pip install failed in $dir"
          fi
          done


      # --------------------- Folder Summary ------------------------------
      - name: ğŸ“‚ List All Project Folders
        run: |
          echo "ğŸ” Project folder structure:"
          tree -L 2 || ls -R

      - name: ğŸ“Œ Save Git Commit Info
        run: |
          echo "ğŸ”– Commit: ${{ github.sha }}"
          echo "ğŸ§‘â€ğŸ’» Author: ${{ github.actor }}"
          echo "ğŸ” Branch: ${{ github.ref }}"

      # ------------------- Lint with Auto-Fix ----------------------------
      - name: ğŸ§¹ Lint Node.js Projects (Auto-Fix)
        run: |
          for dir in frontend backend; do
            echo "ğŸ” Checking $dir for ESLint config..."
            if [ -f "$dir/.eslintrc.json" ] || [ -f "$dir/.eslintrc.js" ]; then
              echo "âœ… ESLint config found in $dir"
              cd "$dir"
              npm install eslint --save-dev
              npx eslint . --ext .js,.jsx,.ts,.tsx --fix || echo "âš ï¸ Linting failed"
              cd ..
            else
              echo "âš ï¸ No ESLint config in $dir. Skipping..."
            fi
          done

      - name: ğŸ§¹ Lint Python Code with Auto-Fix
        if: ${{ hashFiles('**/*.py') != '' }}
        run: |
          echo "ğŸ”§ Installing autopep8 for Python linting"
          pip install autopep8
          echo "ğŸš¨ Running autopep8 to fix Python code"
          autopep8 . --in-place --recursive || echo "âš ï¸ Python linting failed"
